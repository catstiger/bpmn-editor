<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../dist/bpmn-jseditor.js"></script>
    <link rel="icon" href="https://assets.honqun.cn/logo/favicon.png"/>
    <link href="//at.alicdn.com/t/c/font_3594306_rxtwnc4x7f9.css" rel="stylesheet">
    <style>
        #container {
            padding: 20px;
            height: 700px;
            border: 1px solid #eee;
            background: #fff url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImEiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTTAgMTBoNDBNMTAgMHY0ME0wIDIwaDQwTTIwIDB2NDBNMCAzMGg0ME0zMCAwdjQwIiBmaWxsPSJub25lIiBzdHJva2U9IiNlMGUwZTAiIG9wYWNpdHk9Ii4yIi8+PHBhdGggZD0iTTQwIDBIMHY0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2EpIi8+PC9zdmc+) repeat !important;
        }

        #name-editor {
            display: none;
            position: absolute;
        }

        #name-editor input {
            height: 30px;
            line-height: 30px;
            padding: 0 11px;
            box-sizing: border-box;
            width: 80px;
            border: none;
            box-shadow: 0 0 0 1px #ddd inset;
            border-radius: 3px;
            outline: 0;
        }

        #float-bar {
            display: none;
            position: absolute;
        }

        #float-bar button {
            width: 38px;
            height: 38px;
            padding: 10px;
        }

        .bar {
            padding: 10px 10px 15px 10px;
        }

        button {
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: white;
            padding: 6px 15px;
            cursor: pointer;
        }

        button:hover {
            background-color: #ecf5ff;
        }

        button.danger {
            background-color: #f56c6c;
            color: white;
        }
        button.danger:hover {
            background-color: #f89898;
        }
    </style>
</head>
<body>
<div class="bar">
    <button onclick="addElement(BpmnEditor.operations.ADD_STARTEVENT)"><i class="iconfont icon-start-event-none"></i></button>
    <button onclick="addElement(BpmnEditor.operations.ADD_USERTASK)"><i class="iconfont icon-user-task"></i></button>
    <button onclick="addElement(BpmnEditor.operations.ADD_ENDEVENT)"><i class="iconfont icon-end-event-none"></i></button>
    <button onclick="addElement(BpmnEditor.operations.ADD_SUBPROCESS)"><i class="iconfont icon-subprocess"></i></button>
    <button onclick="addElement(BpmnEditor.operations.ADD_EXCLUSIVE_GATEWAY)"><i class="iconfont icon-gateway-xor"></i></button>
    <button onclick="addElement(BpmnEditor.operations.ADD_TIMEREVENT)"><i class="iconfont icon-timer"></i></button>
    <button onclick="addElement(BpmnEditor.operations.PREPARE_DRAW_CONNECTION)"><i class="iconfont icon-connection"></i></button>
    <button onclick="openBpmn()"><i class="iconfont icon-upload"></i></button>
</div>
<!--The drawing area-->
<div id="container">
</div>

<!--Input for editing name-->
<div id="name-editor">
    <input>
</div>

<!--Toolbar-->
<div id="float-bar">
    <button onclick="floatBar(BpmnEditor.operations.ADD_STARTEVENT)"><i class="iconfont icon-start-event-none"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.ADD_USERTASK)"><i class="iconfont icon-user-task"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.ADD_ENDEVENT)"><i class="iconfont icon-end-event-none"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.ADD_SUBPROCESS)"><i class="iconfont icon-subprocess"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.ADD_EXCLUSIVE_GATEWAY)"><i class="iconfont icon-gateway-xor"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.ADD_TIMEREVENT)"><i class="iconfont icon-timer"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.PREPARE_DRAW_CONNECTION)"><i class="iconfont icon-connection"></i></button>
    <button onclick="floatBar(BpmnEditor.operations.REMOVE)" class="danger"><i class="iconfont icon-delete"></i></button>
</div>
<script>
    let editor;
    window.onload = function () {
        editor = new BpmnEditor('#container', {
            name: 'B',
            key: 'A',
            elementClick: clickElement,
            floatBarSelector: '#float-bar',
            inputSelector: '#name-editor'
        })
        let json = JSON.parse('{"bounds":{"upperLeft":{"x":479,"y":374},"lowerRight":{"x":771,"y":454}},"childShapes":[{"outgoing":[{"resourceId":"_570094"}],"bounds":{"upperLeft":{"x":479,"y":396},"lowerRight":{"x":515,"y":432}},"childNodes":[],"dockers":[],"resourceId":"_736968","stencil":{"id":"StartNoneEvent"},"properties":{"trigger":"None","initiator":"initiator","name":"开始","formkeydefinition":"","formproperties":{"formProperties":[]},"executionlisteners":{"executionListeners":[]},"asynchronousdefinition":"No","exclusivedefinition":"Yes"}},{"bounds":{"upperLeft":{"x":575,"y":374},"lowerRight":{"x":675,"y":454}},"childShapes":[],"dockers":[],"outgoing":[{"resourceId":"_295064"}],"properties":{"asynchronousdefinition":"No","bgcolor":"#ffffff","bordercolor":"#000000","callacitivity":"","completioncondition":"","duedatedefinition":"","exclusivedefinition":"Yes","executionlisteners":"","formkeydefinition":"","formproperties":{"formProperties":[]},"inputdataitem":"","isforcompensation":"","loopcardinality":"","loopcondition":"","loopmaximum":"","looptype":"None","name":"用户任务","prioritydefinition":"","processid":"","properties":"","tasklisteners":"","usertaskassignment":{"assignment":{}}},"resourceId":"_831996","stencil":{"id":"UserTask"}},{"bounds":{"lowerRight":{"x":575,"y":414},"upperLeft":{"x":515,"y":414}},"childShapes":[],"dockers":[{"x":18,"y":18},{"x":50,"y":40}],"outgoing":[{"resourceId":"_831996"}],"target":{"resourceId":"_831996"},"properties":{"conditionalflow":"None","conditionsequenceflow":"","defaultflow":"None","overrideid":"","probability":"","executionlisteners":{"executionListeners":[]}},"resourceId":"_570094","stencil":{"id":"SequenceFlow"}},{"bounds":{"upperLeft":{"x":735,"y":396},"lowerRight":{"x":771,"y":432}},"childShapes":[],"dockers":[],"outgoing":[],"properties":{"executionlisteners":{"executionListeners":[]},"name":"结束","asynchronousdefinition":"No","exclusivedefinition":"Yes"},"resourceId":"_662545","stencil":{"id":"EndNoneEvent"}},{"bounds":{"lowerRight":{"x":735,"y":414},"upperLeft":{"x":675,"y":414}},"childShapes":[],"dockers":[{"x":50,"y":40},{"x":18,"y":18}],"outgoing":[{"resourceId":"_662545"}],"target":{"resourceId":"_662545"},"properties":{"conditionalflow":"None","conditionsequenceflow":"","defaultflow":"None","overrideid":"","probability":"","executionlisteners":{"executionListeners":[]}},"resourceId":"_295064","stencil":{"id":"SequenceFlow"}}],"properties":{"process_id":"process-1","name":"我的流程","documentation":"","process_namespace":"http://www.activiti.org/test","process_version":"","targetnamespace":"http://www.activiti.org/processdef","typelanguage":"http://www.w3.org/2001/XMLSchema","version":"","messages":[],"executionlisteners":{"executionListeners":[]},"eventlisteners":{"eventListeners":[]},"signaldefinitions":[],"messagedefinitions":[]},"resourceId":"canvas","ssextensions":[],"stencil":{"id":"BPMNDiagram"},"stencilset":{"namespace":"http://b3mn.org/stencilset/bpmn2.0#"}}')
        editor.json(json)

        document.getElementById('container').addEventListener('dragover', function(e) {
            e.stopPropagation();
            e.preventDefault();
            e.dataTransfer.dragEffect = 'copy';
        })

        document.getElementById('container').addEventListener('drop', function(e) {
            e.stopPropagation();
            e.preventDefault();
            let files = e.dataTransfer.files;
            for(let i = 0; i < files.length; i++) {
                let file = files[i]

                if (!file.name.endsWith('.xml') && !file.name.endsWith('.bpmn')) {
                    alert('请选择XML文件或者BPMN文件')
                    return;
                }
                let reader = new FileReader();
                reader.readAsText(file)
                reader.onload = function () {
                    editor.xml(this.result).then(resp=>{
                        console.log(resp)
                    }).catch(resp=>{
                        console.log(resp)
                    })
                }
            }
        })
    }

    function clickElement(element) {
        console.log(element.json())
    }

    function floatBar(type) {
        editor.onFloatButtons(type)
    }

    function addElement(op) {
        editor.setOperation(op)
    }

    function openBpmn() {
        alert('拖动.bpmn或者.xml文件到编辑区')
    }

</script>
</body>
</html>